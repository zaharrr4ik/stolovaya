{% extends "base.html" %}

{% block title %}Баланс и абонементы - Stolovaia{% endblock %}

{% block content %}
<div style="max-width: 800px; margin: 0 auto; padding: 20px;">
    <h1>Баланс и абонементы</h1>

    <div style="margin: 30px 0; padding: 20px; border: 2px solid #28a745; border-radius: 5px; text-align: center;">
        <h2>Текущий баланс: <span style="color: #28a745;">{{ balance }} протокоинов</span></h2>
        {% if active_subscription %}
        <div style="margin-top: 10px; padding: 10px; background-color: #d4edda; border-radius: 4px;">
            <p style="color: #155724; font-weight: bold;">
                ✅ Активный абонемент до {{ subscription_end_date }}
            </p>
        </div>
        {% endif %}
    </div>

    {% if error %}
    <div style="margin: 20px 0; padding: 15px; background-color: #f8d7da; color: #721c24; border-radius: 4px;">
        {{ error }}
    </div>
    {% endif %}

    {% if message %}
    <div style="margin: 20px 0; padding: 15px; background-color: #d4edda; color: #155724; border-radius: 4px;">
        {{ message }}
    </div>
    {% endif %}

    <div style="margin: 30px 0; padding: 20px; border: 1px solid #dee2e6; border-radius: 5px;">
        <h3>Приобретение абонемента</h3>
        <p>Абонемент позволяет оплатить питание на 5 дней вперед со скидкой!</p>

        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-top: 15px;">
            {% for subscription in subscriptions %}
            <div style="border: 1px solid #dee2e6; padding: 15px; border-radius: 4px; text-align: center;">
                <h4>{{ subscription.name }}</h4>
                <p style="font-size: 24px; font-weight: bold; color: #28a745;">
                    {{ subscription.price }} прот.
                </p>
                <p>{{ subscription.description }}</p>
                <form method="POST" action="/student_subscription/">
                    <input type="hidden" name="action" value="buy_subscription">
                    <input type="hidden" name="subscription_type" value="{{ subscription.type }}">
                    <button type="submit" style="width: 100%; padding: 10px; background: #17a2b8; color: white; border: none; border-radius: 3px; cursor: pointer;">
                        Купить абонемент
                    </button>
                </form>
            </div>
            {% endfor %}
        </div>
    </div>

    <div style="margin: 30px 0; padding: 20px; border: 1px solid #dee2e6; border-radius: 5px;">
        <h3>Пополнить баланс</h3>
        <form method="POST" action="/student_payment/">
            <input type="hidden" name="action" value="deposit">

            <div style="margin: 15px 0;">
                <label style="display: block; margin-bottom: 5px;">Сумма пополнения (протокоины):</label>
                <select name="amount" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 3px;">
                    <option value="100">100 протокоинов</option>
                    <option value="200">200 протокоинов</option>
                    <option value="500">500 протокоинов</option>
                    <option value="1000">1000 протокоинов</option>
                </select>
            </div>

            <button type="submit" style="width: 100%; padding: 12px; background: #28a745; color: white; border: none; border-radius: 3px; cursor: pointer;">
                Пополнить баланс
            </button>
        </form>
    </div>

    <div style="margin: 30px 0; padding: 20px; border: 1px solid #dee2e6; border-radius: 5px;">
    <h3>История покупок</h3>
    {% if purchases %}
    <table style="width: 100%; border-collapse: collapse; margin-top: 15px;">
        <thead>
            <tr style="background-color: #f8f9fa;">
                <th style="border: 1px solid #dee2e6; padding: 8px;">Дата</th>
                <th style="border: 1px solid #dee2e6; padding: 8px;">Тип</th>
                <th style="border: 1px solid #dee2e6; padding: 8px;">Сумма</th>
                <th style="border: 1px solid #dee2e6; padding: 8px;">Описание</th>
            </tr>
        </thead>
        <tbody>
            {% for purchase in purchases %}
            <tr>
                <td style="border: 1px solid #dee2e6; padding: 8px;">{{ purchase.date }}</td>
                <td style="border: 1px solid #dee2e6; padding: 8px;">
                    {% if purchase.type == 'deposit' %}
                        Пополнение
                    {% elif purchase.type == 'subscription' %}
                        Абонемент
                    {% elif purchase.type == 'meal_payment' %}
                        Оплата питания
                    {% else %}
                        {{ purchase.type }}
                    {% endif %}
                </td>
                <td style="border: 1px solid #dee2e6; padding: 8px;">
                    {% if purchase.amount > 0 %}
                    <span style="color: #28a745;">+{{ purchase.amount }}</span>
                    {% else %}
                    <span style="color: #dc3545;">{{ purchase.amount }}</span>
                    {% endif %}
                     прот.
                </td>
                <td style="border: 1px solid #dee2e6; padding: 8px;">{{ purchase.description }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <p style="text-align: center; padding: 20px; color: #666;">Пока нет истории покупок.</p>
    {% endif %}
</div>
</div>
{% endblock %}